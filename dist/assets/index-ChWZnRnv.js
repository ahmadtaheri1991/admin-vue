import{u as L,_ as _e,a as V}from"./axios-C6U-CQOT.js";import{o as g,c as k,t as i,l as E,g as r,m as be,i as m,p as j,f as le,e as G,q as J,a as o,j as t,s as he,w as a,F as I,r as y,v as U,x as b,y as X,b as q,k as ke}from"./index-DyybID5S.js";import{u as N}from"./useQuery-YXMrn9Cc.js";const we={key:0,class:"fw-600"},Ve={class:"fs-14"},xe={__name:"DataLabel",props:["title","value"],setup(F){return(M,R)=>(g(),k("div",null,[F.title?(g(),k("span",we,i(F.title+" : "),1)):E("",!0),r("span",Ve,[be(M.$slots,"default",{},()=>[m(i(F.value),1)])])]))}},Se="/admin-vue/images/labkhand.png",Ce="/admin-vue/images/logo-maze.png",Ie={class:"bg-grey-lighten-3"},Be=["onClick"],Pe={style:{direction:"ltr"}},$e={class:"width-60 text-center"},je={class:"d-flex justify-center"},Ue={class:"width-270 mx-2"},qe={class:"bg-grey-lighten-3"},Fe=["onClick"],Me={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},Ae={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},Oe={class:"d-flex"},ze={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},Ee={__name:"index",setup(F){const M={pending:"grey",rejected:"error",preparation:"amber",posted:"success"},R={pending:"در انتظار",rejected:"رد شده",preparation:"آماده سازی",posted:"پست شده"},Z=[{title:"",key:"id",width:40,sortable:!1,align:"center"},{title:"نام و نام‌خانوادگی",key:"fullName"},{title:"شماره تماس",key:"phone"},{title:"زمان ثبت سفارش",key:"createdAt",align:"center"},{title:"وضعیت",key:"status",align:"center"},{title:"عملیات",key:"actions",align:"center"}],oe=j(()=>{var n;return(n=ee.value)==null?void 0:n.filter(e=>[e.fullName,e.phone].some(u=>u.indexOf(O.value.trim())>-1))}),{data:ee,refetch:A,isPending:ne}=N({queryKey:["orders"],queryFn:()=>V.get("orders")}),{mutate:ae,isPending:se}=L({mutationFn:n=>V.patch(`orders/accept/${n}`),onSuccess:()=>{A()},onError:n=>{console.log(n);const{data:e}=n.response;e.message?appStore.openAlert(2,e.message):appStore.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:re,isPending:ie}=L({mutationFn:n=>V.patch(`orders/reject/${n}`),onSuccess:()=>{A()},onError:n=>{console.log(n);const{data:e}=n.response;e.message?appStore.openAlert(2,e.message):appStore.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:de,isPending:ue}=L({mutationFn:(n,e)=>V.patch(`orders/deliver/${n}`,e),onSuccess:()=>{A()},onError:n=>{console.log(n);const{data:e}=n.response;e.message?appStore.openAlert(2,e.message):appStore.openAlert(2,"عملیات با خطا مواجه شد")}}),te=le(0),d=G({canBeShown:!1,item:null,table:{headers:[{title:"ردیف",key:"row"},{title:"نام محصول",key:"name"},{title:"وزن",key:"weight"},{title:"تعداد",key:"count"},{title:"قیمت واحد",key:"unitPrice"},{title:"قیمت کل",key:"totalPrice"},{title:"عملیات",key:"actions"}],items:[]},open(n){this.canBeShown=!0,this.item=n,this.table.items=j(()=>this.item.orderItems.map(e=>({...e,name:e.product.name,weight:e.weight.name,unitPrice:e.price,totalPrice:e.count*e.price,alternate:e.editOrderItems})))},close(){this.canBeShown=!1}}),O=le("");async function ce(n){const{isConfirmed:e}=await ke();if(!e)return;te.value=n.id;const u={deliveryCode:n.deliveryCode};de(n.id,u)}const{data:K}=N({queryKey:["categories"],queryFn:()=>V.get("categories"),select:n=>n.map(e=>({value:e.id,title:e.name}))}),{data:B}=N({queryKey:["products"],queryFn:()=>V.get("products"),select:n=>n.map(e=>({...e,value:e.id,title:e.name}))}),{data:x}=N({queryKey:["productModels"],queryFn:()=>V.get("productModels"),select:n=>n.map(e=>({...e,value:e.id,title:e.product.name+` (${e.weight.name})`}))}),{mutate:me,isPending:pe}=L({mutationFn:n=>V.post("editOrderItem",n),onSuccess:async()=>{await A(),s.close(),d.item=ee.value.find(n=>n.id==d.item.id)},onError:n=>{console.log(n);const{data:e}=n.response;e.message?appStore.openAlert(2,e.message):appStore.openAlert(2,"عملیات با خطا مواجه شد")}}),s=G({canBeShown:!1,item:null,formRef:null,form:{category:null,product:null,productModel:null,price:null,count:null,totalPrice:j(()=>s.form.count*s.form.price),inventory:null},open(n){this.canBeShown=!0,this.item=n},close(){this.canBeShown=!1},edit(){const{id:n}=d.item,{id:e}=this.item,{productModel:u,price:_,count:f}=s.form,v={orderItemId:e,orderId:n,productModelId:u.value,productId:u.productId,weightId:u.weightId,count:f,price:_};me(v)}});J(()=>s.form.productModel,n=>{var _,f;if(s.form.price=null,s.form.inventory=null,!n)return;const{categoryId:e,productId:u}=x.value.find(v=>v.value==n.value);s.form.category=K.value.find(v=>v.value==e).value,s.form.product=B.value.find(v=>v.value==u).value,s.form.price=(_=x.value.find(v=>v.value==n.value))==null?void 0:_.price,s.form.inventory=(f=x.value.find(v=>v.value==n.value))==null?void 0:f.inventory}),J(()=>s.form.category,n=>{const{categoryId:e}=B.value.find(u=>u.value==s.form.product)||{};e!=n&&(s.form.product=null)}),J(()=>s.form.product,n=>{const{productId:e}=x.value.find(_=>_.value==s.form.productModel.value)||{};if(e!=n&&(s.form.productModel=null),!n)return;const{categoryId:u}=B.value.find(_=>_.value==n);s.form.category=K.value.find(_=>_.value==u).value});const fe=j(()=>{var n;return s.form.category?(n=B.value)==null?void 0:n.filter(e=>e.categoryId==s.form.category):B.value}),ge=j(()=>{var n,e;return!s.form.category&&!s.form.product?x.value:s.form.product?(e=x.value)==null?void 0:e.filter(u=>u.productId==s.form.product):(n=x.value)==null?void 0:n.filter(u=>u.categoryId==s.form.category)}),h=G({canBeShown:!1,item:null,open(n){this.canBeShown=!0,this.item=n},close(){this.canBeShown=!1}});function ve(n){h.open(n)}return(n,e)=>{const u=y("v-text-field"),_=y("v-chip"),f=y("v-btn"),v=y("v-data-table"),T=y("v-card-title"),C=y("v-divider"),P=xe,p=y("v-col"),z=y("v-row"),H=y("v-card-text"),D=y("v-spacer"),Q=y("v-card"),W=y("v-dialog"),Y=y("v-select"),ye=_e;return g(),k(I,null,[o(u,{class:"mb-2",placeholder:"جستجو",modelValue:t(O),"onUpdate:modelValue":e[0]||(e[0]=l=>he(O)?O.value=l:null)},null,8,["modelValue"]),o(v,{class:"border",headers:Z,items:t(oe),"items-per-page":10,loading:t(ne)},{headers:a(({columns:l,isSorted:c,getSortIcon:$,toggleSort:S})=>[r("tr",Ie,[(g(!0),k(I,null,U(l,w=>(g(),k("th",{key:w.key,class:X({"text-center":w.align=="center"})},[r("span",{class:"fw-600 fs-14",onClick:()=>S(w)},i(w.title),9,Be)],2))),128))])]),"item.id":a(({item:l})=>[m(i(t(b)(l.id)),1)]),"item.phone":a(({item:l})=>[m(i(t(b)(l.phone)),1)]),"item.payablePrice":a(({item:l})=>[m(i(n.numberWithCommas(t(b)(l.payablePrice))),1)]),"item.lastFourDigits":a(({item:l})=>[m(i(t(b)(l.lastFourDigits)),1)]),"item.datetime":a(({item:{month:l,day:c,hour:$,minute:S}})=>[r("div",Pe,i(t(b)([l,"/",c," ",$,":",S].join(""))),1)]),"item.createdAt":a(({item:l})=>[m(i(new Date(l.createdAt).toLocaleString("fa-IR",{dateStyle:"medium",timeStyle:"short"})),1)]),"item.status":a(({item:l})=>[o(_,{class:"width-80 text-center",label:"",size:"small",color:M[l.status]},{default:a(()=>[r("div",$e,i(R[l.status]),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[r("div",je,[o(f,{class:"ml-5",color:"primary",text:"جزئیات",onClick:c=>t(d).open(l)},null,8,["onClick"]),r("div",Ue,[o(u,{class:"height-30",density:"compact",variant:"outlined",modelValue:l.deliveryCode,"onUpdate:modelValue":c=>l.deliveryCode=c},null,8,["modelValue","onUpdate:modelValue"])]),o(f,{color:"amber",text:"پست",loading:t(ue)&&t(te)==l.id,onClick:c=>ce(l)},null,8,["loading","onClick"]),o(f,{class:"mr-5",color:"secondary",text:"پرینت",onClick:c=>ve(l)},null,8,["onClick"])])]),_:1},8,["items","loading"]),o(W,{modelValue:t(d).canBeShown,"onUpdate:modelValue":e[4]||(e[4]=l=>t(d).canBeShown=l)},{default:a(()=>[o(Q,{"min-height":"500px"},{default:a(()=>[o(T,{style:{height:"50px"},class:"bg-grey-lighten-3"},{default:a(()=>[m(" جزئیات سفارش "+i(t(d).item.id),1)]),_:1}),o(C,{class:"border-opacity-25",color:"black"}),o(H,null,{default:a(()=>[m(i(t(d).name)+" ",1),o(z,null,{default:a(()=>[o(p,{cols:"auto"},{default:a(()=>[o(P,{value:t(d).item.fullName},null,8,["value"])]),_:1}),(g(!0),k(I,null,U(Z.slice(2,-3),l=>(g(),q(p,{cols:"auto",key:l.id},{default:a(()=>[o(P,{style:{direction:"ltr"},title:l.title,value:t(d).item[l.key]},null,8,["title","value"])]),_:2},1024))),128)),o(p,{cols:"auto"},{default:a(()=>[o(P,{title:"زمان واریز"},{default:a(()=>[r("span",null,i(t(b)([t(d).item.month,"/",t(d).item.day].join(""))),1),e[18]||(e[18]=r("span",{class:"mx-2"},null,-1)),r("span",null,i(t(b)([t(d).item.hour,":",t(d).item.minute].join(""))),1)]),_:1})]),_:1}),o(p,{cols:"auto"},{default:a(()=>[o(P,{title:"۴ رقم آخر شماره کارت",value:t(d).item.lastFourDigits},null,8,["value"])]),_:1}),o(p,{cols:"auto"},{default:a(()=>[o(P,{title:"وضعیت"},{default:a(()=>[r("span",{class:X(`text-${M[t(d).item.status]}`)},i(R[t(d).item.status]),3)]),_:1})]),_:1})]),_:1}),o(v,{class:"border mt-4",headers:t(d).table.headers,items:t(d).table.items,"items-per-page":t(d).table.itemsPerPage,density:"compact","show-expand":""},{bottom:a(()=>e[19]||(e[19]=[])),"item.row":a(({index:l})=>[m(i(l+1),1)]),headers:a(({columns:l,isSorted:c,getSortIcon:$,toggleSort:S})=>[r("tr",qe,[(g(!0),k(I,null,U(l,w=>(g(),k("th",{key:w.key,class:X({"text-center":w.align=="center"})},[r("span",{class:"fw-600 fs-14",onClick:()=>S(w)},i(w.title),9,Fe)],2))),128))])]),"item.actions":a(({item:l})=>[o(f,{color:"primary",onClick:c=>t(s).open(l)},{default:a(()=>e[20]||(e[20]=[m(" ویرایش ")])),_:2},1032,["onClick"])]),"item.data-table-expand":a(({item:{alternate:l},internalItem:c,isExpanded:$,toggleExpand:S})=>[l.length>0?(g(),q(f,{key:0,variant:"text",onClick:w=>S(c),icon:$(c)?"mdi-chevron-up":"mdi-chevron-down"},null,8,["onClick","icon"])):E("",!0)]),"expanded-row":a(({item:{alternate:l}})=>[(g(!0),k(I,null,U(l,c=>(g(),k("tr",{key:c.id},[e[21]||(e[21]=r("td",null,null,-1)),r("td",null,i(c.product.name),1),r("td",null,i(c.weight.name),1),r("td",null,i(c.count),1),r("td",null,i(c.price),1),r("td",null,i(c.price*c.count),1),e[22]||(e[22]=r("td",null,null,-1)),e[23]||(e[23]=r("td",null,null,-1))]))),128))]),_:1},8,["headers","items","items-per-page"])]),_:1}),o(C,{class:"border-opacity-25",color:"black"}),r("div",Me,[o(D),["pending","rejected"].includes(t(d).item.status)?(g(),q(f,{key:0,size:"small",class:"mx-2",color:"green-lighten-4",text:"تایید",flat:"",loading:t(se),onClick:e[1]||(e[1]=()=>{t(ae)(t(d).item.id),t(d).close()})},null,8,["loading"])):E("",!0),["pending","preparation"].includes(t(d).item.status)?(g(),q(f,{key:1,size:"small",class:"mx-2",color:"red-lighten-4",text:"رد",flat:"",loading:t(ie),onClick:e[2]||(e[2]=()=>{t(re)(t(d).item.id),t(d).close()})},null,8,["loading"])):E("",!0),o(f,{size:"small",class:"mx-2",color:"primary",text:"بستن",flat:"",onClick:e[3]||(e[3]=l=>t(d).close())})])]),_:1})]),_:1},8,["modelValue"]),o(W,{width:"95vw","max-width":"900",modelValue:t(s).canBeShown,"onUpdate:modelValue":e[15]||(e[15]=l=>t(s).canBeShown=l)},{default:a(()=>[o(Q,null,{default:a(()=>[o(T,{style:{height:"50px"},class:"bg-grey-lighten-3"},{default:a(()=>e[24]||(e[24]=[m(" ویرایش آیتم سفارش ")])),_:1}),o(C,{class:"border-opacity-25",color:"black"}),o(ye,{modelValue:t(s).formRef,"onUpdate:modelValue":e[13]||(e[13]=l=>t(s).formRef=l),onValid:e[14]||(e[14]=l=>t(s).edit())},{default:a(()=>[o(H,null,{default:a(()=>[o(z,null,{default:a(()=>[o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(Y,{modelValue:t(s).form.category,"onUpdate:modelValue":e[5]||(e[5]=l=>t(s).form.category=l),items:t(K),label:"دسته بندی",variant:"outlined",rules:[n.required],clearable:""},null,8,["modelValue","items","rules"])]),_:1}),o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(Y,{modelValue:t(s).form.product,"onUpdate:modelValue":e[6]||(e[6]=l=>t(s).form.product=l),items:t(fe),label:"محصول",variant:"outlined",rules:[n.required],clearable:""},null,8,["modelValue","items","rules"])]),_:1}),o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(Y,{modelValue:t(s).form.productModel,"onUpdate:modelValue":e[7]||(e[7]=l=>t(s).form.productModel=l),items:t(ge),label:"مدل محصول",variant:"outlined",rules:[n.required],clearable:"","return-object":""},null,8,["modelValue","items","rules"])]),_:1}),o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(u,{readonly:"",modelValue:t(s).form.price,"onUpdate:modelValue":e[8]||(e[8]=l=>t(s).form.price=l),label:"قیمت",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(u,{modelValue:t(s).form.count,"onUpdate:modelValue":e[9]||(e[9]=l=>t(s).form.count=l),label:"تعداد",variant:"outlined",rules:[n.required]},null,8,["modelValue","rules"])]),_:1}),o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(u,{readonly:"",modelValue:t(s).form.totalPrice,"onUpdate:modelValue":e[10]||(e[10]=l=>t(s).form.totalPrice=l),label:"قیمت کل",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[o(u,{readonly:"",modelValue:t(s).form.inventory,"onUpdate:modelValue":e[11]||(e[11]=l=>t(s).form.inventory=l),label:"موجودی",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(C,{class:"border-opacity-25",color:"black"}),r("div",Ae,[o(D),o(f,{size:"small",class:"mx-2",color:"amber",text:"ویرایش",type:"submit",loading:t(pe),flat:""},null,8,["loading"]),o(f,{size:"small",class:"mx-2",color:"error",text:"لغو",flat:"",onClick:e[12]||(e[12]=l=>t(s).close())})])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),o(W,{fullscreen:"",modelValue:t(h).canBeShown,"onUpdate:modelValue":e[17]||(e[17]=l=>t(h).canBeShown=l)},{default:a(()=>[o(Q,null,{default:a(()=>[o(T,{style:{height:"50px"},class:"bg-grey-lighten-3"},{default:a(()=>e[25]||(e[25]=[m(" پرینت ")])),_:1}),o(C,{class:"border-opacity-25",color:"black"}),o(H,null,{default:a(()=>[r("div",Oe,[e[26]||(e[26]=r("div",{class:"d-flex flex-column"},[r("span",null,"فروشگاه اینترنتی مزه رسون"),r("span",{class:"fs-18"},[r("div",{style:{"font-family":"javan !important"}},[m(" دلت یه چیز خوشمزه میخواست؟ "),r("span",{style:{"font-family":"javan !important"},class:"px-1"}," من اینجام "),r("img",{src:Se,width:"13",class:"mx-1",style:{"margin-bottom":"-2px"}})])])],-1)),o(D),e[27]||(e[27]=r("img",{width:"100",src:Ce},null,-1))]),o(z,{dense:""},{default:a(()=>[o(p,{cols:"12"},{default:a(()=>[m("فرستنده: "+i(t(h).item.deliveryCode),1)]),_:1}),o(p,{cols:"6"},{default:a(()=>[m("گیرنده: "+i(t(h).item.fullName),1)]),_:1}),o(p,{cols:"6"},{default:a(()=>[m("شماره تماس: "+i(t(b)(t(h).item.phone)),1)]),_:1}),o(p,{cols:"6"},{default:a(()=>[m("آدرس: "+i(t(h).item.address),1)]),_:1}),o(p,{cols:"6"},{default:a(()=>[m("کد پستی: "+i(t(b)(t(h).item.postalCode)),1)]),_:1}),o(p,{cols:"6"},{default:a(()=>[m("توضیحات: "+i(t(h).item.description),1)]),_:1})]),_:1}),e[28]||(e[28]=r("div",{class:"mt-5 mb-3"},"سفارش‌ها",-1)),o(z,null,{default:a(()=>[(g(!0),k(I,null,U(t(h).item.orderItems,(l,c)=>(g(),q(p,{cols:"6",key:l.id},{default:a(()=>[m(i(t(b)(c+1))+" - "+i(l.product.name)+" "+i(t(b)(l.weight.name))+" ("+i(t(b)(l.count))+" عدد) ",1)]),_:2},1024))),128))]),_:1})]),_:1}),o(C,{class:"border-opacity-25",color:"black"}),r("div",ze,[o(D),o(f,{size:"small",class:"mx-2",color:"error",text:"لغو",flat:"",onClick:e[16]||(e[16]=l=>t(h).close())})])]),_:1})]),_:1},8,["modelValue"])],64)}}};export{Ee as default};
