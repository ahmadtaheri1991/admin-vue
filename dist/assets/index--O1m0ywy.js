import{u as h,_ as J,a as c}from"./axios-C6U-CQOT.js";import{u as O,f as X,e as Z,q as I,p as ee,c as te,a as n,j as o,w as a,F as oe,n as le,z as M,A as q,r as d,o as re,g as i,t as m,B as C,C as ne,y as se,i as ae,D as P,k as de,E as ie}from"./index-DyybID5S.js";import{u as g}from"./useQuery-YXMrn9Cc.js";const ue={class:"d-flex justify-center"},ce={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},ve={__name:"index",setup(me){const S=[{title:"شناسه",key:"id"},{title:"دسته‌بندی",key:"category"},{title:"محصول",key:"product"},{title:"بسته‌بندی",key:"weight"},{title:"قیمت",key:"price"},{title:"موجودی",key:"inventory"},{title:"عملیات",key:"actions",align:"center",sortable:!1}],u=O(),{data:A,refetch:v,isPending:B}=g({queryKey:["productModels"],queryFn:()=>c.get("productModels")}),{data:b}=g({queryKey:["categories"],queryFn:()=>c.get("categories"),select:t=>t.map(e=>({value:e.id,title:e.name}))}),{data:f}=g({queryKey:["products"],queryFn:()=>c.get("products"),select:t=>t.map(e=>({...e,value:e.id,title:e.name}))}),{data:F}=g({queryKey:["weights"],queryFn:()=>c.get("weights"),select:t=>t.map(e=>({value:e.id,title:e.name}))}),{mutate:$,isPending:U}=h({mutationFn:t=>c.post("productModels",t),onSuccess:()=>{u.openAlert(0,"با موفقیت افزوده شد"),v(),l.close()},onError:t=>{console.log(t);const{data:e}=t.response;e.message?u.openAlert(2,e.message):u.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:E,isPending:N}=h({mutationFn:(t,e)=>c.patch(`productModels/${t}`,e),onSuccess:()=>{u.openAlert(0,"با موفقیت ویرایش شد"),v(),l.close()},onError:t=>{console.log(t);const{data:e}=t.response;e.message?u.openAlert(2,e.message):u.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:D,isPending:K}=h({mutationFn:t=>c.delete(`productModels/${t}`),onSuccess:()=>{u.openAlert(0,"حذف با موفقیت انجام شد"),v()},onError:t=>{console.log(t);const{data:e}=t.response;e.message?u.openAlert(2,e.message):u.openAlert(2,"عملیات با خطا مواجه شد")}}),w=X(0),l=Z({canBeShown:!1,item:null,formRef:null,form:{category:null,product:null,weight:null,price:"",inventory:""},async open(t){var e;this.canBeShown=!0,this.item=null,await le(),(e=this.formRef)==null||e.reset(),t&&(this.item=t,this.form.category=t.categoryId,this.form.product=t.productId,this.form.weight=t.weightId,this.form.price=t.price,this.form.inventory=t.inventory)},close(){this.canBeShown=!1},add(){const t={categoryId:this.form.category,productId:this.form.product,weightId:this.form.weight,price:this.form.price,inventory:this.form.inventory};$(t)},update(){const t={categoryId:this.form.category,productId:this.form.product,weightId:this.form.weight,price:M(q(this.form.price)),inventory:M(q(this.form.inventory))};E(this.item.id,t)}});async function L(t){const{isConfirmed:e}=await de();e&&(w.value=t.id,D(t.id))}I(()=>l.form.category,t=>{let{product:e}=l.form;const{categoryId:s}=f.value.find(y=>y.value==e)||{};s!=t&&(l.form.product=null)}),I(()=>l.form.product,t=>{if(!t)return;const{categoryId:e}=f.value.find(s=>s.value==t);l.form.category=b.value.find(s=>s.value==e).value});const R=ee(()=>{var e;const{category:t}=l.form;return t?(e=f.value)==null?void 0:e.filter(s=>s.categoryId==t):f.value});return(t,e)=>{const s=d("v-btn"),y=d("v-data-table"),j=d("v-card-title"),V=d("v-divider"),_=d("v-select"),p=d("v-col"),k=d("v-text-field"),z=d("v-row"),T=d("v-card-text"),W=d("v-spacer"),Q=J,Y=d("v-card"),G=d("v-dialog"),x=ie("persian-digit");return re(),te(oe,null,[n(s,{class:"mb-3",color:"primary",text:"افزودن مدل محصول",onClick:e[0]||(e[0]=r=>o(l).open())}),n(y,{class:"border",headers:S,items:o(A),"items-per-page":10,loading:o(B)},{item:a(({item:r})=>[i("tr",{class:se({"bg-red-lighten-4":r.inventory<10})},[i("td",null,m(r.id),1),i("td",null,m(r.category.name),1),i("td",null,m(r.product.name),1),i("td",null,m(r.weight.name),1),i("td",null,m(o(C)(o(ne)(r.price))),1),i("td",null,m(o(C)(r.inventory)),1),i("td",null,[i("div",ue,[n(s,{class:"mx-1",text:"ویرایش",color:"warning",onClick:H=>o(l).open(r)},null,8,["onClick"]),n(s,{class:"mx-1",text:"حذف",color:"error",loading:o(K)&&o(w)==r.id,onClick:H=>L(r)},null,8,["loading","onClick"])])])],2)]),_:1},8,["items","loading"]),n(G,{"max-width":"900",modelValue:o(l).canBeShown,"onUpdate:modelValue":e[9]||(e[9]=r=>o(l).canBeShown=r)},{default:a(()=>[n(Y,null,{default:a(()=>[n(Q,{modelValue:o(l).formRef,"onUpdate:modelValue":e[7]||(e[7]=r=>o(l).formRef=r),onValid:e[8]||(e[8]=r=>o(l).item?o(l).update():o(l).add())},{default:a(()=>[n(j,{style:{height:"50px"},class:"bg-grey-lighten-3"},{default:a(()=>[ae(m(o(l).item?"ویرایش مدل محصول":"افزودن مدل محصول"),1)]),_:1}),n(V,{class:"border-opacity-25",color:"black"}),n(T,null,{default:a(()=>[n(z,null,{default:a(()=>[n(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[n(_,{disabled:o(l).item,modelValue:o(l).form.category,"onUpdate:modelValue":e[1]||(e[1]=r=>o(l).form.category=r),items:o(b),label:"دسته بندی",variant:"outlined",rules:[t.required],clearable:""},null,8,["disabled","modelValue","items","rules"])]),_:1}),n(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[n(_,{disabled:o(l).item,modelValue:o(l).form.product,"onUpdate:modelValue":e[2]||(e[2]=r=>o(l).form.product=r),items:o(R),label:"محصول",variant:"outlined",rules:[t.required],clearable:""},null,8,["disabled","modelValue","items","rules"])]),_:1}),n(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[n(_,{disabled:o(l).item,modelValue:o(l).form.weight,"onUpdate:modelValue":e[3]||(e[3]=r=>o(l).form.weight=r),items:o(F),label:"بسته‌بندی",variant:"outlined",rules:[t.required]},null,8,["disabled","modelValue","items","rules"])]),_:1}),n(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[P(n(k,{modelValue:o(l).form.price,"onUpdate:modelValue":e[4]||(e[4]=r=>o(l).form.price=r),label:"قیمت",variant:"outlined",rules:[t.required]},null,8,["modelValue","rules"]),[[x]])]),_:1}),n(p,{cols:"12",sm:"6",md:"4"},{default:a(()=>[P(n(k,{modelValue:o(l).form.inventory,"onUpdate:modelValue":e[5]||(e[5]=r=>o(l).form.inventory=r),label:"موجودی",variant:"outlined",rules:[t.required]},null,8,["modelValue","rules"]),[[x]])]),_:1})]),_:1})]),_:1}),n(V,{class:"border-opacity-25",color:"black"}),i("div",ce,[n(W),n(s,{class:"ml-2",type:"submit","min-width":"100",color:"primary",text:o(l).item?"ویرایش":"افزودن",loading:o(U)||o(N)},null,8,["text","loading"]),n(s,{"min-width":"100",color:"error",text:"لغو",onClick:e[6]||(e[6]=r=>o(l).close())})])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])],64)}}};export{ve as default};
