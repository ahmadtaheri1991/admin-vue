import{u as p,_ as pe,a as c}from"./axios-C6U-CQOT.js";import{u as fe,f as V,e as q,c as w,j as o,F as C,a,w as r,g as f,t as A,n as j,r as d,o as S,i as N,k as K}from"./index-DyybID5S.js";import{r as I,a as P}from"./formRules-BWjmuk4-.js";import{u as T}from"./useQuery-YXMrn9Cc.js";const ge={class:"d-flex justify-center"},_e={class:"d-flex"},ve={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},ye={class:"d-flex justify-center"},he={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},Ce={__name:"index",setup(xe){const H=[{title:"شناسه",key:"id"},{title:"نام",key:"name"},{title:"عملیات",key:"actions",align:"center",sortable:!1}],M=[{title:"شناسه",key:"id"},{title:"نام",key:"name"},{title:"دسته‌بندی",key:"category"},{title:"عملیات",key:"actions",align:"center",sortable:!1}],i=fe(),y=V(!1),{data:Q,refetch:h,isPending:Y}=T({queryKey:["categories"],queryFn:()=>c.get("categories")}),{data:z,refetch:x,isPending:G}=T({queryKey:["products"],queryFn:()=>c.get("products")}),{mutate:J,isPending:O}=p({mutationFn:e=>c.post("categories",e),onSuccess:()=>{i.openAlert(0,"با موفقیت افزوده شد"),h(),s.close()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?i.openAlert(2,t.message):i.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:W,isPending:X}=p({mutationFn:(e,t)=>c.patch(`categories/${e}`,t),onSuccess:()=>{i.openAlert(0,"با موفقیت ویرایش شد"),h(),s.close()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?i.openAlert(2,t.message):i.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:Z,isPending:ee}=p({mutationFn:e=>c.delete(`categories/${e}`),onSuccess:()=>{i.openAlert(0,"حذف با موفقیت انجام شد"),h()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?i.openAlert(2,t.message):i.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:te,isPending:oe}=p({mutationFn:e=>c.post("products",e),onSuccess:()=>{i.openAlert(0,"با موفقیت افزوده شد"),l.formRef.reset(),x()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?i.openAlert(2,t.message):i.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:ae,isPending:ne}=p({mutationFn:(e,t)=>c.patch(`products/${e}`,t),onSuccess:()=>{i.openAlert(0,"با موفقیت ویرایش شد"),l.clear(),x()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?i.openAlert(2,t.message):i.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:le,isPending:se}=p({mutationFn:e=>c.delete(`products/${e}`),onSuccess:()=>{i.openAlert(0,"حذف با موفقیت انجام شد"),x()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?i.openAlert(2,t.message):i.openAlert(2,"عملیات با خطا مواجه شد")}}),g=V(0),s=q({canBeShown:!1,item:null,formRef:null,form:{name:"",image:[]},async open(e){var t;this.canBeShown=!0,this.item=null,await j(),(t=this.formRef)==null||t.reset(),this.form.image=[],e&&(this.item=e,this.form.name=e.name)},close(){this.canBeShown=!1},add(){const e=new FormData;e.append("name",this.form.name),e.append("image",this.form.image[0]),J(e)},update(){const e=new FormData;e.append("name",this.form.name),this.form.image.length&&e.append("image",this.form.image[0]),W(this.item.id,e)}}),l=q({canBeShown:!1,item:null,formRef:null,form:{name:"",category:null,coverImage:[],images:[],description:""},async open(e){var t;this.canBeShown=!0,this.item=null,await j(),(t=this.formRef)==null||t.reset(),this.form.coverImage=[],this.form.images=[],e&&(this.item=e,this.form.name=e.name,this.form.category=e.categoryId,this.form.description=e.description)},add(){const e=new FormData;e.append("name",this.form.name),e.append("categoryId",_.value.id),e.append("description",this.form.description),e.append("image",this.form.coverImage[0]),this.form.images.forEach(t=>{e.append("gallery",t)}),te(e)},update(){const e=new FormData;e.append("name",this.form.name),e.append("categoryId",this.form.category),e.append("description",this.form.description),this.form.images.length&&e.append("gallery",this.form.images),this.form.coverImage.length&&e.append("image",this.form.coverImage[0]),ae(this.item.id,e)},clear(){var e;this.item=null,(e=this.formRef)==null||e.reset(),this.form.coverImage=[],this.form.images=[]}}),_=V(null);async function re(e){const{isConfirmed:t}=await K();t&&(g.value=e.id,Z(e.id))}async function ie(e){const{isConfirmed:t}=await K();t&&(g.value=e.id,le(e.id))}function de(e){_.value=e,y.value=!0}return(e,t)=>{var L;const m=d("v-btn"),$=d("v-data-table"),F=d("v-text-field"),u=d("v-col"),b=d("v-file-input"),me=d("v-textarea"),B=d("v-row"),R=d("v-card-text"),k=d("v-divider"),D=d("v-spacer"),U=pe,E=d("v-card"),ce=d("v-card-title"),ue=d("v-dialog");return S(),w(C,null,[o(y)?(S(),w(C,{key:1},[f("div",_e,[f("span",null,A(o(_).name),1),a(m,{"append-icon":"mdi-keyboard-backspace",class:"mb-3 mr-auto d-flex",text:"بازگشت به دسته‌بندی‌ها",color:"primary",onClick:t[1]||(t[1]=n=>y.value=!1)})]),a(E,{class:"mb-3"},{default:r(()=>[a(U,{modelValue:o(l).formRef,"onUpdate:modelValue":t[7]||(t[7]=n=>o(l).formRef=n),onValid:t[8]||(t[8]=n=>o(l).item?o(l).update():o(l).add())},{default:r(()=>[a(R,null,{default:r(()=>[a(B,null,{default:r(()=>[a(u,{cols:"12",sm:"6",md:"4"},{default:r(()=>[a(F,{disabled:o(l).item,modelValue:o(l).form.name,"onUpdate:modelValue":t[2]||(t[2]=n=>o(l).form.name=n),label:"نام محصول",variant:"outlined",rules:[o(I)]},null,8,["disabled","modelValue","rules"])]),_:1}),a(u,{cols:"12",sm:"6",md:"4"},{default:r(()=>[a(b,{modelValue:o(l).form.coverImage,"onUpdate:modelValue":t[3]||(t[3]=n=>o(l).form.coverImage=n),"prepend-icon":"",label:"تصویر اصلی",variant:"outlined",rules:[o(l).item?null:o(P)]},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12",sm:"6",md:"4"},{default:r(()=>[a(b,{modelValue:o(l).form.images,"onUpdate:modelValue":t[4]||(t[4]=n=>o(l).form.images=n),"prepend-icon":"",label:"تصاویر",variant:"outlined",rules:[o(l).item?null:o(P)],multiple:""},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12"},{default:r(()=>[a(me,{modelValue:o(l).form.description,"onUpdate:modelValue":t[5]||(t[5]=n=>o(l).form.description=n),label:"توضیحات",variant:"outlined",rows:"2",rules:[o(I)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),a(k,{class:"border-opacity-25",color:"black"}),f("div",ve,[a(D),a(m,{class:"ml-2",type:"submit","min-width":"100",color:"primary",text:o(l).item?"ویرایش":"افزودن",loading:o(oe)||o(ne)},null,8,["text","loading"]),a(m,{"min-width":"100",color:"error",text:"لغو",onClick:t[6]||(t[6]=n=>o(l).clear())})])]),_:1},8,["modelValue"])]),_:1}),a($,{class:"border",headers:M,items:(L=o(z))==null?void 0:L.filter(n=>n.categoryId==o(_).id),"items-per-page":10,loading:o(G)},{"item.category":r(({item:n})=>[N(A(n.category.name),1)]),"item.actions":r(({item:n})=>[f("div",ye,[a(m,{class:"mx-1",text:"ویرایش",color:"warning",onClick:v=>o(l).open(n)},null,8,["onClick"]),a(m,{class:"mx-1",text:"حذف",color:"error",loading:o(se)&&o(g)==n.id,onClick:v=>ie(n)},null,8,["loading","onClick"])])]),_:1},8,["items","loading"])],64)):(S(),w(C,{key:0},[a(m,{class:"mb-3",text:"افزودن دسته‌بندی",color:"primary",onClick:t[0]||(t[0]=n=>o(s).open())}),a($,{class:"border",headers:H,items:o(Q),"items-per-page":10,loading:o(Y)},{"item.actions":r(({item:n})=>[f("div",ge,[a(m,{class:"mx-1",text:"افزودن محصول",color:"primary",onClick:v=>de(n)},null,8,["onClick"]),a(m,{class:"mx-1",text:"ویرایش",color:"warning",onClick:v=>o(s).open(n)},null,8,["onClick"]),a(m,{class:"mx-1",text:"حذف",color:"error",loading:o(ee)&&o(g)==n.id,onClick:v=>re(n)},null,8,["loading","onClick"])])]),_:1},8,["items","loading"])],64)),a(ue,{"max-width":"500",modelValue:o(s).canBeShown,"onUpdate:modelValue":t[14]||(t[14]=n=>o(s).canBeShown=n)},{default:r(()=>[a(E,null,{default:r(()=>[a(U,{modelValue:o(s).formRef,"onUpdate:modelValue":t[12]||(t[12]=n=>o(s).formRef=n),onValid:t[13]||(t[13]=n=>o(s).item?o(s).update():o(s).add())},{default:r(()=>[a(ce,{style:{height:"50px"},class:"bg-grey-lighten-3"},{default:r(()=>[N(A(o(s).item?"ویرایش دسته‌بندی":"افزودن دسته‌بندی"),1)]),_:1}),a(k,{class:"border-opacity-25",color:"black"}),a(R,null,{default:r(()=>[a(B,null,{default:r(()=>[a(u,{cols:"12"},{default:r(()=>[a(F,{disabled:o(s).item,modelValue:o(s).form.name,"onUpdate:modelValue":t[9]||(t[9]=n=>o(s).form.name=n),label:"نام دسته‌بندی",variant:"outlined",rules:[o(I)]},null,8,["disabled","modelValue","rules"])]),_:1}),a(u,{cols:"12"},{default:r(()=>[a(b,{modelValue:o(s).form.image,"onUpdate:modelValue":t[10]||(t[10]=n=>o(s).form.image=n),"prepend-icon":"",label:"تصویر",variant:"outlined",rules:[o(s).item?null:o(P)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),a(k,{class:"border-opacity-25",color:"black"}),f("div",he,[a(D),a(m,{class:"ml-2",type:"submit","min-width":"100",color:"primary",text:o(s).item?"ویرایش":"افزودن",loading:o(O)||o(X)},null,8,["text","loading"]),a(m,{"min-width":"100",color:"error",text:"لغو",onClick:t[11]||(t[11]=n=>o(s).close())})])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])],64)}}};export{Ce as default};
