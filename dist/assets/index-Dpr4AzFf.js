import{u as g,_ as pe,a as m}from"./axios-C6U-CQOT.js";import{u as fe,f as I,e as E,c as P,j as o,F as A,a as n,w as s,g as d,t as p,n as L,r as c,o as M,i as D,y as ge,k as K}from"./index-DyybID5S.js";import{u as _}from"./useQuery-YXMrn9Cc.js";const ye={class:"d-flex justify-center"},ve={class:"d-flex"},he={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},_e={class:"d-flex justify-center"},be={style:{height:"50px"},class:"d-flex px-4 py-2 flex-wrap align-center bg-grey-lighten-4"},Ie={__name:"index",setup(we){const j=[{title:"شناسه",key:"id"},{title:"نام",key:"name"},{title:"دسته‌بندی",key:"category"},{title:"عملیات",key:"actions",align:"center",sortable:!1}],N=[{title:"شناسه",key:"id"},{title:"دسته‌بندی",key:"category"},{title:"محصول",key:"product"},{title:"بسته‌بندی",key:"weight"},{title:"قیمت",key:"price"},{title:"موجودی",key:"inventory"},{title:"عملیات",key:"actions",align:"center",sortable:!1}],a=fe(),{data:T,refetch:b,isPending:z}=_({queryKey:["products"],queryFn:()=>m.get("products")}),{data:H,refetch:w,isPending:Q}=_({queryKey:["productModels"],queryFn:()=>m.get("productModels")}),{data:Y}=_({queryKey:["categories"],queryFn:()=>m.get("categories"),select:e=>e.map(t=>({value:t.id,title:t.name}))}),{data:G}=_({queryKey:["weights"],queryFn:()=>m.get("weights"),select:e=>e.map(t=>({value:t.id,title:t.name}))}),{mutate:J,isPending:O}=g({mutationFn:e=>m.post("products",e),onSuccess:()=>{a.openAlert(0,"با موفقیت افزوده شد"),b(),r.close()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?a.openAlert(2,t.message):a.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:W,isPending:X}=g({mutationFn:(e,t)=>m.patch(`products/${e}`,t),onSuccess:()=>{a.openAlert(0,"با موفقیت ویرایش شد"),b(),r.close()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?a.openAlert(2,t.message):a.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:Z,isPending:ee}=g({mutationFn:e=>m.delete(`products/${e}`),onSuccess:()=>{a.openAlert(0,"حذف با موفقیت انجام شد"),b()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?a.openAlert(2,t.message):a.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:te,isPending:oe}=g({mutationFn:e=>m.post("productModels",e),onSuccess:()=>{a.openAlert(0,"با موفقیت افزوده شد"),i.formRef.reset(),w()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?a.openAlert(2,t.message):a.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:le,isPending:ne}=g({mutationFn:(e,t)=>m.patch(`productModels/${e}`,t),onSuccess:()=>{a.openAlert(0,"با موفقیت ویرایش شد"),i.clear(),w()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?a.openAlert(2,t.message):a.openAlert(2,"عملیات با خطا مواجه شد")}}),{mutate:re,isPending:se}=g({mutationFn:e=>m.delete(`productModels/${e}`),onSuccess:()=>{a.openAlert(0,"حذف با موفقیت انجام شد"),w()},onError:e=>{console.log(e);const{data:t}=e.response;t.message?a.openAlert(2,t.message):a.openAlert(2,"عملیات با خطا مواجه شد")}}),v=I(0),r=E({canBeShown:!1,item:null,formRef:null,form:{name:"",category:null,coverImage:[],images:[],description:""},async open(e){var t;this.canBeShown=!0,this.item=null,await L(),(t=this.formRef)==null||t.reset(),this.form.coverImage=[],this.form.images=[],e&&(this.item=e,this.form.name=e.name,this.form.category=e.categoryId,this.form.description=e.description)},close(){this.canBeShown=!1},add(){const e=new FormData;e.append("name",this.form.name),e.append("categoryId",this.form.category),e.append("description",this.form.description),e.append("image",this.form.coverImage[0]),this.form.images.forEach(t=>{e.append("gallery",t)}),J(e)},update(){const e=new FormData;e.append("name",this.form.name),e.append("categoryId",this.form.category),e.append("description",this.form.description),this.form.images.length&&e.append("gallery",this.form.images),this.form.coverImage.length&&e.append("image",this.form.coverImage[0]),W(this.item.id,e)}}),i=E({canBeShown:!1,item:null,formRef:null,form:{category:null,product:null,weight:null,price:"",inventory:""},async open(e){var t;this.canBeShown=!0,this.item=null,await L(),(t=this.formRef)==null||t.reset(),e&&(this.item=e,this.form.category=e.categoryId,this.form.product=e.productId,this.form.weight=e.weightId,this.form.price=e.price,this.form.inventory=e.inventory)},add(){const e={categoryId:y.value.categoryId,productId:y.value.id,weightId:this.form.weight,price:this.form.price,inventory:this.form.inventory};te(e)},update(){const e={categoryId:this.form.category,productId:this.form.product,weightId:this.form.weight,price:this.form.price,inventory:this.form.inventory};le(this.item.id,e)},clear(){var e;this.item=null,(e=this.formRef)==null||e.reset()}});async function ae(e){const{isConfirmed:t}=await K();t&&(v.value=e.id,Z(e.id))}async function ie(e){const{isConfirmed:t}=await K();t&&(v.value=e.id,re(e.id))}const y=I(null),V=I(!1);function de(e){y.value=e,V.value=!0}return(e,t)=>{const u=c("v-btn"),C=c("v-data-table"),S=c("v-select"),f=c("v-col"),k=c("v-text-field"),q=c("v-row"),$=c("v-card-text"),x=c("v-divider"),F=c("v-spacer"),U=pe,B=c("v-card"),ce=c("v-card-title"),R=c("v-file-input"),ue=c("v-textarea"),me=c("v-dialog");return M(),P(A,null,[o(V)?(M(),P(A,{key:1},[d("div",ve,[d("span",null,p(o(y).name),1),n(u,{"append-icon":"mdi-keyboard-backspace",class:"mb-3 mr-auto d-flex",text:"بازگشت به محصولات",color:"primary",onClick:t[1]||(t[1]=l=>V.value=!1)})]),n(B,{class:"mb-3"},{default:s(()=>[n(U,{modelValue:o(i).formRef,"onUpdate:modelValue":t[6]||(t[6]=l=>o(i).formRef=l),onValid:t[7]||(t[7]=l=>o(i).item?o(i).update():o(i).add())},{default:s(()=>[n($,null,{default:s(()=>[n(q,null,{default:s(()=>[n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(S,{disabled:o(i).item,modelValue:o(i).form.weight,"onUpdate:modelValue":t[2]||(t[2]=l=>o(i).form.weight=l),items:o(G),label:"بسته‌بندی",variant:"outlined",rules:[e.required]},null,8,["disabled","modelValue","items","rules"])]),_:1}),n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(k,{modelValue:o(i).form.price,"onUpdate:modelValue":t[3]||(t[3]=l=>o(i).form.price=l),label:"قیمت",variant:"outlined",rules:[e.required]},null,8,["modelValue","rules"])]),_:1}),n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(k,{modelValue:o(i).form.inventory,"onUpdate:modelValue":t[4]||(t[4]=l=>o(i).form.inventory=l),label:"موجودی",variant:"outlined",rules:[e.required]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),n(x,{class:"border-opacity-25",color:"black"}),d("div",he,[n(F),n(u,{class:"ml-2",type:"submit","min-width":"100",color:"primary",text:o(i).item?"ویرایش":"افزودن",loading:o(oe)||o(ne)},null,8,["text","loading"]),n(u,{"min-width":"100",color:"error",text:"لغو",onClick:t[5]||(t[5]=l=>o(i).clear())})])]),_:1},8,["modelValue"])]),_:1}),n(C,{class:"border",headers:N,items:o(H).filter(l=>l.productId==o(y).id),"items-per-page":10,loading:o(Q)},{item:s(({item:l})=>[d("tr",{class:ge({"bg-red-lighten-4":l.inventory<10})},[d("td",null,p(l.id),1),d("td",null,p(l.category.name),1),d("td",null,p(l.product.name),1),d("td",null,p(l.weight.name),1),d("td",null,p(l.price),1),d("td",null,p(l.inventory),1),d("td",null,[d("div",_e,[n(u,{class:"mx-1",text:"ویرایش",color:"warning",onClick:h=>o(i).open(l)},null,8,["onClick"]),n(u,{class:"mx-1",text:"حذف",color:"error",loading:o(se)&&o(v)==l.id,onClick:h=>ie(l)},null,8,["loading","onClick"])])])],2)]),_:1},8,["items","loading"])],64)):(M(),P(A,{key:0},[n(u,{class:"mb-3",color:"primary",text:"افرودن محصول",onClick:t[0]||(t[0]=l=>o(r).open())}),n(C,{class:"border",headers:j,items:o(T),"items-per-page":10,loading:o(z)},{"item.category":s(({item:l})=>[D(p(l.category.name),1)]),"item.actions":s(({item:l})=>[d("div",ye,[n(u,{class:"mx-1",text:"افزودن مدل محصول",color:"primary",onClick:h=>de(l)},null,8,["onClick"]),n(u,{class:"mx-1",text:"ویرایش",color:"warning",onClick:h=>o(r).open(l)},null,8,["onClick"]),n(u,{class:"mx-1",text:"حذف",color:"error",loading:o(ee)&&o(v)==l.id,onClick:h=>ae(l)},null,8,["loading","onClick"])])]),_:1},8,["items","loading"])],64)),n(me,{"max-width":"900",modelValue:o(r).canBeShown,"onUpdate:modelValue":t[16]||(t[16]=l=>o(r).canBeShown=l)},{default:s(()=>[n(B,null,{default:s(()=>[n(U,{modelValue:o(r).formRef,"onUpdate:modelValue":t[14]||(t[14]=l=>o(r).formRef=l),onValid:t[15]||(t[15]=l=>o(r).item?o(r).update():o(r).add())},{default:s(()=>[n(ce,{style:{height:"50px"},class:"bg-grey-lighten-3"},{default:s(()=>[D(p(o(r).item?"ویرایش محصول":"افزودن محصول"),1)]),_:1}),n(x,{class:"border-opacity-25",color:"black"}),n($,null,{default:s(()=>[n(q,null,{default:s(()=>[n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(k,{disabled:o(r).item,modelValue:o(r).form.name,"onUpdate:modelValue":t[8]||(t[8]=l=>o(r).form.name=l),label:"نام محصول",variant:"outlined",rules:[e.required]},null,8,["disabled","modelValue","rules"])]),_:1}),n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(S,{disabled:o(r).item,modelValue:o(r).form.category,"onUpdate:modelValue":t[9]||(t[9]=l=>o(r).form.category=l),items:o(Y),label:"دسته بندی",variant:"outlined",rules:[e.required]},null,8,["disabled","modelValue","items","rules"])]),_:1}),n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(R,{modelValue:o(r).form.coverImage,"onUpdate:modelValue":t[10]||(t[10]=l=>o(r).form.coverImage=l),"prepend-icon":"",label:"تصویر اصلی",variant:"outlined",rules:[o(r).item?null:e.requiredArray]},null,8,["modelValue","rules"])]),_:1}),n(f,{cols:"12",sm:"6",md:"4"},{default:s(()=>[n(R,{modelValue:o(r).form.images,"onUpdate:modelValue":t[11]||(t[11]=l=>o(r).form.images=l),"prepend-icon":"",label:"تصاویر",variant:"outlined",rules:[o(r).item?null:e.requiredArray],multiple:""},null,8,["modelValue","rules"])]),_:1}),n(f,{cols:"12"},{default:s(()=>[n(ue,{modelValue:o(r).form.description,"onUpdate:modelValue":t[12]||(t[12]=l=>o(r).form.description=l),label:"توضیحات",variant:"outlined",rules:[e.required]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),n(x,{class:"border-opacity-25",color:"black"}),d("div",be,[n(F),n(u,{class:"ml-2",type:"submit","min-width":"100",color:"primary",text:o(r).item?"ویرایش":"افزودن",loading:o(O)||o(X)},null,8,["text","loading"]),n(u,{"min-width":"100",color:"error",text:"لغو",onClick:t[13]||(t[13]=l=>o(r).close())})])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])],64)}}};export{Ie as default};
